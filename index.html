<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Умный генератор Рапидо 2</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 10px;
            background: #f5f5f7;
            color: #1c1c1e;
            max-width: 100%;
            margin: 0 auto;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #0066cc;
            text-align: center;
        }
        .numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }
        .number {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background: #0066cc;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .number.small {
            background: #ff2d55;
        }
        button {
            width: 100%;
            padding: 12px;
            background: #0066cc;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
        }
        button:active {
            opacity: 0.8;
        }
        textarea {
            width: 100%;
            height: 80px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 10px;
        }
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .stats-table th, .stats-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        .hot {
            color: #ff2d55;
            font-weight: bold;
        }
        .cold {
            color: #007aff;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>Умный генератор Рапидо 2</h1>
        <p style="text-align: center;">Анализирует историю и предлагает числа</p>
    </div>

    <div class="card">
        <h2>Сгенерировать числа</h2>
        <div class="numbers" id="field1"></div>
        <div class="numbers" id="field2"></div>
        <button onclick="generateSmartNumbers()">Умная генерация</button>
        <button onclick="generateRandomNumbers()">Случайные числа</button>
    </div>

    <div class="card">
        <h2>Добавить историю</h2>
        <textarea id="historyInput" placeholder="Формат: 1,3,5,7,9,11,13,15 | 2"></textarea>
        <button onclick="addHistory()">Добавить</button>
    </div>

    <div class="card">
        <h2>Статистика чисел (Поле 1)</h2>
        <table class="stats-table">
            <tr>
                <th>Число</th>
                <th>Выпало раз</th>
                <th>Статус</th>
            </tr>
            <tbody id="statsTable"></tbody>
        </table>
    </div>

    <div class="card">
        <h2>История розыгрышей</h2>
        <div id="historyList"></div>
        <button onclick="clearHistory()">Очистить историю</button>
    </div>

    <script>
        // Данные
        let history = JSON.parse(localStorage.getItem('rapido2_history')) || [];
        let stats = { field1: {}, field2: {} };

        // Загрузка при старте
        updateStats();
        updateHistoryList();

        // Анализ истории
        function updateStats() {
            stats = { field1: {}, field2: {} };

            // Считаем частоту чисел
            history.forEach(entry => {
                const [field1Str, field2Str] = entry.split(' | ');
                const field1Numbers = field1Str.split(',').map(Number);
                const field2Number = parseInt(field2Str);

                // Поле 1
                field1Numbers.forEach(num => {
                    stats.field1[num] = (stats.field1[num] || 0) + 1;
                });

                // Поле 2
                stats.field2[field2Number] = (stats.field2[field2Number] || 0) + 1;
            });

            // Обновляем таблицу
            renderStatsTable();
        }

        // Отображение статистики
        function renderStatsTable() {
            const table = document.getElementById('statsTable');
            table.innerHTML = '';

            // Сортируем по частоте
            const sortedNumbers = Object.entries(stats.field1)
                .sort((a, b) => b[1] - a[1]);

            // Определяем "горячие" и "холодные"
            const hotNumbers = sortedNumbers.slice(0, 5).map(item => parseInt(item[0]));
            const coldNumbers = sortedNumbers.slice(-5).map(item => parseInt(item[0]));

            // Заполняем таблицу
            sortedNumbers.forEach(([num, count]) => {
                const row = document.createElement('tr');
                const numCell = document.createElement('td');
                const countCell = document.createElement('td');
                const statusCell = document.createElement('td');

                numCell.textContent = num;
                countCell.textContent = count;

                if (hotNumbers.includes(parseInt(num))) {
                    statusCell.textContent = 'Горячее';
                    statusCell.className = 'hot';
                } else if (coldNumbers.includes(parseInt(num))) {
                    statusCell.textContent = 'Холодное';
                    statusCell.className = 'cold';
                }

                row.appendChild(numCell);
                row.appendChild(countCell);
                row.appendChild(statusCell);
                table.appendChild(row);
            });
        }

        // Умная генерация
        function generateSmartNumbers() {
            const field1Candidates = getWeightedNumbers(stats.field1, 8);
            const field2Candidates = getWeightedNumbers(stats.field2, 1);

            displayNumbers(field1Candidates, field2Candidates);
        }

        // Случайная генерация
        function generateRandomNumbers() {
            const field1 = [];
            while (field1.length < 8) {
                const num = Math.floor(Math.random() * 20) + 1;
                if (!field1.includes(num)) field1.push(num);
            }
            field1.sort((a, b) => a - b);

            const field2 = Math.floor(Math.random() * 4) + 1;
            displayNumbers(field1, field2);
        }

        // Весовая выборка (частота влияет на вероятность)
        function getWeightedNumbers(numberStats, count) {
            const numbers = Object.keys(numberStats).map(Number);
            const weights = numbers.map(num => numberStats[num] || 1);

            // Нормализуем веса (чтобы даже редкие числа имели шанс)
            const minWeight = Math.min(...weights);
            const adjustedWeights = weights.map(w => w + minWeight);

            const result = [];
            while (result.length < count) {
                const totalWeight = adjustedWeights.reduce((a, b) => a + b, 0);
                let random = Math.random() * totalWeight;
                let selectedIndex = 0;

                for (let i = 0; i < adjustedWeights.length; i++) {
                    random -= adjustedWeights[i];
                    if (random <= 0) {
                        selectedIndex = i;
                        break;
                    }
                }

                const selectedNum = numbers[selectedIndex];
                if (!result.includes(selectedNum)) {
                    result.push(selectedNum);
                }
            }

            return count === 1 ? result[0] : result.sort((a, b) => a - b);
        }

        // Отображение чисел
        function displayNumbers(field1, field2) {
            const field1El = document.getElementById('field1');
            const field2El = document.getElementById('field2');

            field1El.innerHTML = Array.isArray(field1) 
                ? field1.map(num => `<div class="number">${num}</div>`).join('')
                : `<div class="number">${field1}</div>`;

            field2El.innerHTML = `<div class="number small">${field2}</div>`;
        }

        // Добавление в историю
        function addHistory() {
            const input = document.getElementById('historyInput').value.trim();
            if (!input) return alert("Введите данные!");

            history.push(input);
            localStorage.setItem('rapido2_history', JSON.stringify(history));
            updateStats();
            updateHistoryList();
            document.getElementById('historyInput').value = '';
        }

        // Обновление списка истории
        function updateHistoryList() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = history.map((item, index) => 
                `<div style="padding: 8px; border-bottom: 1px solid #eee;">${index + 1}. ${item}</div>`
            ).join('');
        }

        // Очистка истории
        function clearHistory() {
            if (confirm("Удалить всю историю?")) {
                history = [];
                localStorage.removeItem('rapido2_history');
                updateStats();
                updateHistoryList();
            }
        }

        // Первая генерация
        generateRandomNumbers();
    </script>
</body>
</html>
